pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- spirico
-- by wombart
-- initially made for the minijam 25 :

local p_info = {x = 64, y = 64, tag = 'player', current_health = 0, move_speed = 2, sprites = {idle ={1, 2}, running = {17, 18, 18, 18}}, sounds = {running = 0}}
local player
local gameobjects = {}
local game_state = 'game'
function _init()
    start()
end

function start()
    init_all_gameobject()
end

function _update60()
    if game_state == 'start' then

    elseif game_state == 'game' then
        update_game()
    elseif game_state == 'gameover' then

    end
end

function _draw()
    if game_state == 'start' then

    elseif game_state == 'game' then
        draw_game()
    elseif game_state == 'gameover' then
        
    end
end
 
function update_game()
    update_all_gameobject()
end

function draw_game()
    cls()
    draw_all_gameobject()
end

function update_all_gameobject()
    for obj in all(gameobjects) do
        obj:update()
    end
end

function draw_all_gameobject()
    for obj in all(gameobjects) do
        obj:draw()
    end
end

function init_all_gameobject()
    make_player()
end

function make_player()
    local _player = make_gameobject(p_info.x, p_info.y, p_info.tag, {
        current_health = p_info.current_health,
        c_sprite=1,
        state = 'idle',
        sfx_playing = false,
        look_to_right = true,
        sounds = p_info.sounds,
        sprites = p_info.sprites,
        move_speed = p_info.move_speed,
        move = function(self)
            if btn(0) then
                self.x -= self.move_speed
                self.state = 'running'
                self.side = -1
            end
            if btn(1) then
                self.x += self.move_speed
                self.state = 'running'
                self.side = 1
            end
            if not btn(0) and not btn(1) then
                self.state = 'idle'
            end
        end,
        update_sprite = function(self)
            local table = self.sprites.idle
            local speed = 2

            if self.state == 'running' then 
                table = self.sprites.running
                speed = self.move_speed*6
            end

            local n = flr(time()*speed%#table)+1
            self.c_sprite = table[n]
        end,
        draw_sprite = function(self)
            spr(self.c_sprite, self.x, self.y, 1, 1, self.side)
        end,
        player_sounds = function(self)
            if self.state == 'running' then
                if self.c_sprite == 17 and self.sfx_playing == false then
                    sfx(self.sounds.running)
                    self.sfx_playing = true
                end
            else
                self.sfx_playing = false
            end
        end,
        update = function (self)
            self:player_sounds()
            self:move()
            self:update_sprite()
        end,
        draw = function(self)


            self:draw_sprite()
        end

    })
    player = _player
end

function make_gameobject(x, y, tag, properties)

    local obj = {x = x, y = y, tag = tag, active = true, 
        get_tag = function(self)
            return self.tag
        end,
        disable = function(self)
            del(game_objects, self)
        end,
        draw = function(self)

        end,
        update = function(self)

        end
    }
    if properties != nil then
        for k, v in pairs(properties) do
            obj[k] = v
        end
    end

    add(gameobjects, obj)
end
__gfx__
00000000000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009900000599900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700059990005544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005544000055bb777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700055bb777055b3667700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070055b366775636000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566600000063000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003300000033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009900000599900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000059990005544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005544000055bb777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055bb777055b3667700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055b366775666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566600000033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000099000000990000009900000099000000990000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009900000599900005999000059990000599900005999000000000000000000000000000000000000000000000000000000000000000000000000000
00000000059990005544000055440000554400005544000055440000000000000000000000000000000000000000000000000000000000000000000000000000
000000005544000055bb000055bb000055bb777055bb000055bb0000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055bb777055b3700055b3700055b3667755b3700055b37000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055b366775666670056666700566600005666670056666700000000000000000000000000000000000000000000000000000000000000000000000000
00000000566600000033067000330670003300000033067000330670000000000000000000000000000000000000000000000000000000000000000000000000
00000000003300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000207001f73029700227001c700117000670000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700
00010000006003163029630226301c030110300603000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600
